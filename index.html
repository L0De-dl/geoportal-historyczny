<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>HGIS - Gołańcz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- LEAFLET CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    /* === PODSTAWY STRONY === */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    #mapa {
      width: 100vw;
      height: 100vh;
    }

    /* === TYTUŁ MAPY === */
    .tytul-mapy {
      background: white;
      padding: 8px 12px;
      margin: 10px;
      border-radius: 8px;
      font-size: 20px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      font-family: 'Tahoma', sans-serif;
    }

    /* === PANEL WYBORU SCEN === */
    .przycisk-sceny {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px;
      border-radius: 6px;
      cursor: pointer;
      border: 1px solid transparent;
      user-select: none;
    }

    .przycisk-sceny img {
      width: 28px;
      height: 28px;
      object-fit: contain;
      display: block;
    }

    .przycisk-sceny.aktywna {
      background: #f0f0f0;
      border-color: #bbb;
    }

    .opis-sceny {
      font-size: 13px;
      font-family: 'Tahoma', sans-serif;
      color: #333;
      line-height: 1;
    }

    .naglowek-scen {
      font-size: 12px;
      font-weight: bold;
      text-align: center;
      margin: 4px 0;
      color: #222;
    }

    /* === STYL KONTROLKI WARSTW === */
    .leaflet-control-layers { 
      touch-action: manipulation;
    }

    .leaflet-control-layers-base label {
      font-size: 13px;
      font-family: 'Verdana', sans-serif;
      color: #444;
    }

    .naglowek-warstw {
      font-size: 12px;
      font-weight: bold;
      text-align: center;
      color: #222;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>

  <!-- MAPA -->
  <div id="mapa"></div>

  <!-- LEAFLET JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // === INICJALIZACJA MAPY ===
  const mapa = L.map('mapa', { zoomControl: false, zoomSnap: 0.5 })
                .setView([52.9435, 17.3002], 17.5);

  // === GRANICE MAPY ===
  mapa.setMaxBounds([
    [52.9490239, 17.2852683], // NW
    [52.9381943, 17.3122189]  // SE
  ]);

  mapa.setMinZoom(mapa.getBoundsZoom([
    [52.9490239, 17.2852683],
    [52.9381943, 17.3122189]
  ]));

  // === KONTROLKI ===
  // Tytuł mapy
  const kontrolkaTytulu = L.control({ position: "topleft" });
  kontrolkaTytulu.onAdd = function() {
    const div = L.DomUtil.create("div", "tytul-mapy");
    div.innerHTML = "Gołańcz – interaktywny przegląd zmian przestrzennych";
    return div;
  };
  kontrolkaTytulu.addTo(mapa);

  // Zoom
  L.control.zoom({ position: "topleft" }).addTo(mapa);

  // Skala
  L.control.scale({ imperial: false, metric: true, position: 'bottomleft' }).addTo(mapa);

  // === PODKŁADY MAPOWE ===
  const podkladOSM = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
    subdomains: 'abcd',
  }).addTo(mapa);

  const podklad1890 = L.imageOverlay('1890.jpg', [[52.9490319, 17.3121943], [52.9382133, 17.2852466]]);
  const podklad1911 = L.imageOverlay('1911.jpg', [[52.9490257, 17.3122210], [52.9381925, 17.2852721]]);
  const podklad1934 = L.imageOverlay('1934.jpg', [[52.9490222, 17.3122162], [52.9382042, 17.2852771]]);
  const podklad1940 = L.imageOverlay('1940.jpg', [[52.9490216, 17.3122245], [52.9381925, 17.2852719]]);
  const podklad1941 = L.imageOverlay('1941.jpg', [[52.9490186, 17.3122318], [52.9381960, 17.2852748]]);
  const podklad1966 = L.imageOverlay('1966.jpg', [[52.9490219, 17.3122117], [52.9381881, 17.2852638]]);
  const podklad1981 = L.imageOverlay('1981.jpg', [[52.9490213, 17.3122149], [52.9381963, 17.2852654]]);
  const podklad2002 = L.imageOverlay('2002.jpg', [[52.9490239, 17.3122189], [52.9381943, 17.2852683]]);
  const podklad2025 = L.tileLayer('');

  const mapaPodklady = {
    "Mapa z 1890 roku": podklad1890,
    "Mapa z 1911 roku": podklad1911,
    "Mapa z 1934 roku": podklad1934,
    "Mapa z 1940 roku": podklad1940,
    "Mapa z 1941 roku": podklad1941,
    "Mapa z 1966 roku": podklad1966,
    "Mapa z 1981 roku": podklad1981,
    "Mapa z 2002 roku": podklad2002,
    "Mapa z 2025 roku": podklad2025
  };

  const kontrolkaWarstw = L.control.layers(mapaPodklady, null, { collapsed: false }).addTo(mapa);

  // Dodanie nagłówka w panelu
  const kontenerWarstw = kontrolkaWarstw.getContainer();
  const naglowekWarstw = document.createElement("div");
  naglowekWarstw.innerHTML = "<strong>WYBÓR PODKŁADU</strong>";
  naglowekWarstw.className = "naglowek-warstw";
  kontenerWarstw.insertBefore(naglowekWarstw, kontenerWarstw.firstChild);

  // === MARKERY SCEN ===
  const ikonaZolta     = L.icon({ iconUrl: '1.png',  iconSize: [25,25] });
  const ikonaZoltaCiemna = L.icon({ iconUrl: '1c.png', iconSize: [25,25] });
  const ikonaCzerwona  = L.icon({ iconUrl: '2.png',  iconSize: [25,25] });
  const ikonaCzerwonaCiemna = L.icon({ iconUrl: '2c.png', iconSize: [25,25] });
  const ikonaNiebieska = L.icon({ iconUrl: '3.png',  iconSize: [25,25] });
  const ikonaNiebieskaCiemna = L.icon({ iconUrl: '3c.png', iconSize: [25,25] });

  const znacznik1 = L.marker([52.944121, 17.299766], { icon: ikonaZolta });
  znacznik1.on('mouseover', () => znacznik1.setIcon(ikonaZoltaCiemna));
  znacznik1.on('mouseout',  () => znacznik1.setIcon(ikonaZolta));
  znacznik1.on('click',     () => { window.location.href = "https://l0de-dl.github.io/scena1"; });

  const znacznik2 = L.marker([52.9438975, 17.2995147], { icon: ikonaCzerwona });
  znacznik2.on('mouseover', () => znacznik2.setIcon(ikonaCzerwonaCiemna));
  znacznik2.on('mouseout',  () => znacznik2.setIcon(ikonaCzerwona));
  znacznik2.on('click',     () => { window.location.href = "https://l0de-dl.github.io/scena2"; });

  const znacznik3 = L.marker([52.942454, 17.300135], { icon: ikonaNiebieska });
  znacznik3.on('mouseover', () => znacznik3.setIcon(ikonaNiebieskaCiemna));
  znacznik3.on('mouseout',  () => znacznik3.setIcon(ikonaNiebieska));
  znacznik3.on('click',     () => { window.location.href = "https://l0de-dl.github.io/scena3"; });

  const wszystkieZnaczniki = [znacznik1, znacznik2, znacznik3];

  // Usuwanie wszystkich znaczników
  function usunZnaczniki() {
    wszystkieZnaczniki.forEach(z => { if (mapa.hasLayer(z)) mapa.removeLayer(z); });
  }

  // Pokazywanie wybranej sceny
  function pokazScene(nr) {
    usunZnaczniki();
    if (nr === 1) mapa.addLayer(znacznik1);
    if (nr === 2) mapa.addLayer(znacznik2);
    if (nr === 3) mapa.addLayer(znacznik3);

    document.querySelectorAll('.przycisk-sceny').forEach((btn, idx) => {
      btn.classList.toggle('aktywna', (idx + 1) === nr);
    });
  }

  // === WYBÓR SCENY W TYM SAMYM PANELU ===
  const separator = document.createElement('hr');
  separator.style.margin = "6px 0";
  separator.style.border = "none";
  separator.style.borderTop = "1px solid #ccc";
  kontenerWarstw.appendChild(separator);

  const naglowekScen = document.createElement('div');
  naglowekScen.innerHTML = "<strong>WYBÓR SCENY</strong>";
  naglowekScen.className = "naglowek-scen";
  kontenerWarstw.appendChild(naglowekScen);

  function utworzPrzyciskSceny(nr, opis, ikonaUrl) {
    const przycisk = document.createElement('div');
    przycisk.className = 'przycisk-sceny';
    przycisk.setAttribute('role', 'button');
    przycisk.setAttribute('tabindex', '0');

    const obrazek = document.createElement('img');
    obrazek.src = ikonaUrl;
    obrazek.alt = opis;

    const t = document.createElement('div');
    t.className = 'opis-sceny';
    t.textContent = opis;

    przycisk.appendChild(obrazek);
    przycisk.appendChild(t);

    przycisk.addEventListener('click', () => pokazScene(nr));
    przycisk.addEventListener('keydown', (e) => { 
      if (e.key === 'Enter' || e.key === ' ') { 
        e.preventDefault(); 
        pokazScene(nr); 
      } 
    });

    return przycisk;
  }

  kontenerWarstw.appendChild(utworzPrzyciskSceny(1, 'Scena 1', '1.png'));
  kontenerWarstw.appendChild(utworzPrzyciskSceny(2, 'Scena 2', '2.png'));
  kontenerWarstw.appendChild(utworzPrzyciskSceny(3, 'Scena 3', '3.png'));

  // === POCZĄTEK: Scena 1 ===
  pokazScene(1);

// === GRUPY GEOJSON ===
const warstwaDrzewaNow = L.geoJSON(drzewa_now, {
  style: { color: "#398e3c", weight: 0.5, fillColor: "#79dc7d", fillOpacity: 0.5 }
});
const warstwaDrzewaThen = L.geoJSON(drzewa_then, {
  pointToLayer: (f, latlng) => L.circleMarker(latlng, {
    radius: 6, color: "#4d4d4d", weight: 1, fillColor: "#a6a6a6", fillOpacity: 0.5
  })
});

const warstwaPomnikNow = L.geoJSON(pomnik_now, {
  pointToLayer: (f, latlng) => L.circleMarker(latlng, {
    radius: 6, color: "#bb2a2a", weight: 1, fillColor: "#d95959", fillOpacity: 0.5
  })
});
const warstwaPomnikThen = L.geoJSON(pomnik_then, {
  pointToLayer: (f, latlng) => L.circleMarker(latlng, {
    radius: 6, color: "#4d4d4d", weight: 1, fillColor: "#a6a6a6", fillOpacity: 0.5
  })
});

const warstwaKosciolNow = L.geoJSON(kosciol_now, {
  pointToLayer: (f, latlng) => L.circleMarker(latlng, {
    radius: 6, color: "#002db3", weight: 1, fillColor: "#668cff", fillOpacity: 0.5
  })
});
const warstwaKosciolThen = L.geoJSON(kosciol_then, {
  pointToLayer: (f, latlng) => L.circleMarker(latlng, {
    radius: 6, color: "#4d4d4d", weight: 1, fillColor: "#a6a6a6", fillOpacity: 0.5
  })
});

// === ZBIORY GEOJSON DO SCEN ===
const warstwyScen = {
  1: [warstwaDrzewaNow, warstwaDrzewaThen],
  2: [warstwaPomnikNow, warstwaPomnikThen],
  3: [warstwaKosciolNow, warstwaKosciolThen]
};

function usunWarstwy() {
  Object.values(warstwyScen).flat().forEach(w => { if (mapa.hasLayer(w)) mapa.removeLayer(w); });
}

// Dodajemy obsługę GeoJSON do funkcji pokazScene
function pokazScene(nr) {
  usunZnaczniki();
  usunWarstwy();

  if (nr === 1) { mapa.addLayer(znacznik1); warstwyScen[1].forEach(w => mapa.addLayer(w)); }
  if (nr === 2) { mapa.addLayer(znacznik2); warstwyScen[2].forEach(w => mapa.addLayer(w)); }
  if (nr === 3) { mapa.addLayer(znacznik3); warstwyScen[3].forEach(w => mapa.addLayer(w)); }

  document.querySelectorAll('.przycisk-sceny').forEach((btn, idx) => {
    btn.classList.toggle('aktywna', (idx + 1) === nr);
  });

  // aktualizacja legendy
  aktualizujLegende(nr);
}

// === LEGENDA ===
const legenda = document.createElement("div");
legenda.style.fontSize = "12px";
legenda.style.margin = "4px 0";
kontenerWarstw.appendChild(legenda);

function aktualizujLegende(nr) {
  if (nr === 1) legenda.innerHTML = "Legenda: <br>1 – Drzewa obecne<br>2 – Drzewa dawne";
  if (nr === 2) legenda.innerHTML = "Legenda: <br>1 – Pomnik obecny<br>2 – Pomnik dawny";
  if (nr === 3) legenda.innerHTML = "Legenda: <br>1 – Kościół obecny<br>2 – Kościół dawny";
}

// Start od sceny 1
pokazScene(1);

</script>
</body>
</html>

















